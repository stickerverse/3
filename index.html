<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Font Previewer</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .editor-area {
        background-color: #fff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      #editor-canvas {
        width: 100%;
        height: 200px;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        font-size: 24px;
        box-sizing: border-box;
        resize: none;
      }

      .font-gallery {
        background-color: #fff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 15px;
        max-height: 500px;
        overflow-y: auto;
      }

      .font-box {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        height: 100px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .font-box:hover {
        border-color: #aaa;
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .font-box.selected {
        border-color: #007bff;
        border-width: 2px;
        background-color: #f0f7ff;
      }

      .font-name {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-family: Arial, sans-serif;
      }

      .font-preview {
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-size: 16px;
        overflow: hidden;
      }

      .controls {
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .loading {
        text-align: center;
        padding: 40px;
        font-size: 18px;
        color: #666;
      }

      .control-group {
        display: flex;
        align-items: center;
      }

      .control-group label {
        margin-right: 10px;
        white-space: nowrap;
      }

      #font-size {
        width: 60px;
      }

      #filter-input {
        padding: 5px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 200px;
      }

      #loading-progress {
        margin-top: 10px;
        font-size: 14px;
        color: #666;
      }

      .no-results {
        grid-column: 1 / -1;
        text-align: center;
        padding: 20px;
        color: #666;
      }

      .error {
        color: #d9534f;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Font Previewer</h1>

      <div class="controls">
        <div class="control-group">
          <label for="font-size">Font Size:</label>
          <input type="number" id="font-size" min="8" max="72" value="24" />
        </div>

        <div class="control-group">
          <label for="filter-input">Filter Fonts:</label>
          <input type="text" id="filter-input" placeholder="Search fonts..." />
        </div>
      </div>

      <div class="editor-area">
        <textarea
          id="editor-canvas"
          placeholder="Type your text here to preview it in different fonts..."
        >
Sample Text</textarea
        >
      </div>

      <h2>Available Fonts (<span id="font-count">0</span>)</h2>
      <div id="font-gallery" class="font-gallery">
        <div class="loading">
          Loading fonts from local folder...
          <div id="loading-progress"></div>
        </div>
      </div>
    </div>

    <script>
      // Configuration
      const FONTS_FOLDER = "/fonts"; // Path to your local fonts folder
      const FONT_EXTENSIONS = [".ttf", ".otf", ".woff", ".woff2"];

      // Variables
      let loadedFonts = [];
      let filteredFonts = [];
      let selectedFontIndex = -1;
      let editorText = "Sample Text";

      // DOM Elements
      const editorCanvas = document.getElementById("editor-canvas");
      const fontGallery = document.getElementById("font-gallery");
      const fontSizeInput = document.getElementById("font-size");
      const loadingProgress = document.getElementById("loading-progress");
      const fontCountElement = document.getElementById("font-count");
      const filterInput = document.getElementById("filter-input");

      // Initialize
      document.addEventListener("DOMContentLoaded", async () => {
        // Set up event listeners
        editorCanvas.addEventListener("input", updatePreviews);
        fontSizeInput.addEventListener("change", updateFontSize);
        filterInput.addEventListener("input", filterFonts);

        try {
          // Load fonts from the local folder
          await loadFontsFromLocalFolder();
          updatePreviews();
        } catch (error) {
          console.error("Error loading fonts:", error);
          fontGallery.innerHTML = `<div class="loading error">Error loading fonts: ${error.message}</div>`;
        }
      });

      // Load fonts from the local folder
      async function loadFontsFromLocalFolder() {
        try {
          // First try to load fonts from fonts.json
          const fontFiles = await loadFontsFromJson();

          if (fontFiles.length === 0) {
            throw new Error("No font files found");
          }

          // Clear the gallery
          fontGallery.innerHTML = "";

          // Process each font file
          let loadedCount = 0;
          const totalCount = fontFiles.length;

          for (const fontFile of fontFiles) {
            try {
              // Get font information
              const fontName = getFontNameFromPath(fontFile);
              const fontUrl = `${FONTS_FOLDER}/${fontFile}`;

              // Create a font face rule
              const fontFaceRule = `
              @font-face {
                font-family: '${fontName}';
                src: url('${fontUrl}') format('${getFormatFromExtension(getExtension(fontFile))}');
                font-weight: normal;
                font-style: normal;
              }
            `;

              // Add the font face to the document
              const style = document.createElement("style");
              style.textContent = fontFaceRule;
              document.head.appendChild(style);

              // Add the font to the loaded fonts array
              loadedFonts.push({
                name: fontName,
                family: fontName,
                url: fontUrl,
                path: fontFile,
              });

              // Update progress
              loadedCount++;
              loadingProgress.textContent = `Loaded ${loadedCount} of ${totalCount} fonts`;
            } catch (error) {
              console.warn(`Failed to load font ${fontFile}:`, error);
            }
          }

          // Update the filtered fonts
          filteredFonts = [...loadedFonts];

          // Update the font count
          fontCountElement.textContent = loadedFonts.length;

          // Create font preview boxes
          createFontBoxes();

          // Select the first font
          if (loadedFonts.length > 0) {
            selectFont(0);
          }
        } catch (error) {
          console.error("Error loading fonts from local folder:", error);
          fontGallery.innerHTML = `
          <div class="loading error">
            Error loading fonts from the local folder. Please make sure you have fonts in the "/fonts" folder 
            and run the scan-fonts.js script to generate fonts.json.
          </div>
        `;
          throw error;
        }
      }

      // Load fonts from fonts.json
      async function loadFontsFromJson() {
        try {
          const response = await fetch("/fonts.json");

          if (!response.ok) {
            throw new Error(
              `Failed to load fonts.json (${response.status}: ${response.statusText})`,
            );
          }

          return await response.json();
        } catch (error) {
          console.error("Error loading fonts.json:", error);

          // Try to scan the folder manually
          return await scanFontsFolder();
        }
      }

      // Scan the fonts folder for font files
      async function scanFontsFolder() {
        console.log("Trying to scan fonts folder manually...");

        // This is a client-side implementation, which has limitations
        // In a real Replit application, this should be done server-side

        // Try some common font file names
        const fontFiles = [];
        const commonFontNames = [
          "Arial",
          "Helvetica",
          "Times",
          "Verdana",
          "Roboto",
          "OpenSans",
          "Montserrat",
          "Lato",
          "Font1",
          "Font2",
          "Font3",
          "Font4",
          "Font5",
        ];

        for (const fontName of commonFontNames) {
          for (const ext of FONT_EXTENSIONS) {
            const fileName = `${fontName}${ext}`;
            try {
              const response = await fetch(`${FONTS_FOLDER}/${fileName}`, {
                method: "HEAD",
              });
              if (response.ok) {
                fontFiles.push(fileName);
              }
            } catch (error) {
              // Ignore errors - file probably doesn't exist
            }
          }
        }

        if (fontFiles.length === 0) {
          console.warn("Could not find any font files through manual scanning");
        }

        return fontFiles;
      }

      // Create font preview boxes for all filtered fonts
      function createFontBoxes() {
        // Clear the gallery
        fontGallery.innerHTML = "";

        // If no fonts are found
        if (filteredFonts.length === 0) {
          fontGallery.innerHTML =
            '<div class="no-results">No fonts match your filter</div>';
          return;
        }

        // Create a box for each font
        filteredFonts.forEach((font, index) => {
          createFontBox(font.name, index);
        });
      }

      // Create a single font preview box
      function createFontBox(fontName, index) {
        const fontBox = document.createElement("div");
        fontBox.className = "font-box";
        fontBox.dataset.index = index;

        const nameElement = document.createElement("div");
        nameElement.className = "font-name";
        nameElement.textContent = fontName;

        const previewElement = document.createElement("div");
        previewElement.className = "font-preview";
        previewElement.style.fontFamily = `'${fontName}', sans-serif`;
        previewElement.textContent = editorText;

        fontBox.appendChild(nameElement);
        fontBox.appendChild(previewElement);

        fontBox.addEventListener("click", () => {
          selectFont(index);
        });

        fontGallery.appendChild(fontBox);
      }

      // Select a font
      function selectFont(index) {
        if (index < 0 || index >= filteredFonts.length) {
          return;
        }

        // Remove selection from previous font
        if (selectedFontIndex !== -1) {
          const prevBox = document.querySelector(
            `.font-box[data-index="${selectedFontIndex}"]`,
          );
          if (prevBox) {
            prevBox.classList.remove("selected");
          }
        }

        // Set new selection
        selectedFontIndex = index;
        const selectedFont = filteredFonts[index];

        // Update editor font
        editorCanvas.style.fontFamily = `'${selectedFont.family}', sans-serif`;

        // Update selection visual
        const currentBox = document.querySelector(
          `.font-box[data-index="${index}"]`,
        );
        if (currentBox) {
          currentBox.classList.add("selected");

          // Scroll to make selected font visible if needed
          currentBox.scrollIntoView({ behavior: "smooth", block: "nearest" });
        }
      }

      // Filter fonts based on search term
      function filterFonts() {
        const searchTerm = filterInput.value.toLowerCase();

        if (searchTerm === "") {
          // If search is empty, show all fonts
          filteredFonts = [...loadedFonts];
        } else {
          // Filter fonts by name
          filteredFonts = loadedFonts.filter((font) =>
            font.name.toLowerCase().includes(searchTerm),
          );
        }

        // Update font count
        fontCountElement.textContent = filteredFonts.length;

        // Recreate font preview boxes
        createFontBoxes();

        // Reset selection if needed
        if (filteredFonts.length > 0) {
          selectFont(0);
        } else {
          selectedFontIndex = -1;
        }
      }

      // Update font previews when text changes
      function updatePreviews() {
        editorText = editorCanvas.value || "Sample Text";

        // Update all preview elements
        const previewElements = document.querySelectorAll(".font-preview");
        previewElements.forEach((element) => {
          element.textContent = editorText;
        });
      }

      // Update font size
      function updateFontSize() {
        const fontSize = fontSizeInput.value;

        // Update all preview elements
        const previewElements = document.querySelectorAll(".font-preview");
        previewElements.forEach((element) => {
          element.style.fontSize = `${fontSize}px`;
        });
      }

      // Helper function to get font name from file path
      function getFontNameFromPath(path) {
        // Extract filename without extension
        const fileName = path.split("/").pop().split(".")[0];

        // Clean up the name
        return fileName
          .replace(/[_-]/g, " ") // Replace underscores and hyphens with spaces
          .replace(/([A-Z])/g, " $1") // Add spaces before capital letters
          .trim();
      }

      // Helper function to get file extension
      function getExtension(path) {
        return path.split(".").pop().toLowerCase();
      }

      // Helper function to get font format based on file extension
      function getFormatFromExtension(ext) {
        switch (ext) {
          case "ttf":
            return "truetype";
          case "otf":
            return "opentype";
          case "woff":
            return "woff";
          case "woff2":
            return "woff2";
          default:
            return "truetype";
        }
      }
    </script>
  </body>
</html>
